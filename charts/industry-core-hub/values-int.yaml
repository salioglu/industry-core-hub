###############################################################
# Eclipse Tractus-X - Industry Core Hub
#
# Copyright (c) 2025 Contributors to the Eclipse Foundation
#
# See the NOTICE file(s) distributed with this work for additional
# information regarding copyright ownership.
#
# This program and the accompanying materials are made available under the
# terms of the Apache License, Version 2.0 which is available at
# https://www.apache.org/licenses/LICENSE-2.0.
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.
#
# SPDX-License-Identifier: Apache-2.0
###############################################################
---
## For being used in the Integration ArgoCD test environment from the Catena-X Association

deploymentMode: "argocd"

participantId : "<path:industry-core-hub/data/edc-provider#bpn>"

postgresql:
  auth:
    ## Root password override
    password: <path:industry-core-hub/data/db#rootPass>
    ## Industry Core User Password
    ichubPassword: <path:industry-core-hub/data/db#ichubPass>
# -- pgAdmin4 configuration
pgadmin4:
  enabled: true
  env:
    email: <path:industry-core-hub/data/pgadmin#email>
    password: <path:industry-core-hub/data/pgadmin#password>
  ingress:
    enabled: true
    ingressClassName: "nginx"
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
      - host: pgadmin-ichub.int.catena-x.net
        paths:
          - path: /
            pathType: Prefix
    tls:
       - secretName: "pgadmin-ichub.int.catena-x.net-tls"
         hosts:
           - "pgadmin-ichub.int.catena-x.net" 
frontend: 
  config:
    # Core application
    environment: "integration"
    version: "1.0.0"
    
    # API configuration
    ichubBackendUrl: "https://backend-ichub.int.catena-x.net/v1"
    apiTimeout: 20000
    apiRetryAttempts: 2
    requireHttpsUrlPattern: true
    
    # API key configuration (disabled for integration)
    apiKey: ""
    apiKeyHeader: "X-API-Key"
    enableApiKeyRotation: false
    apiKeyExpiryWarningDays: 7
    
    # Authentication configuration
    authEnabled: true
    authProvider: keycloak
    authSessionTimeout: 3600000  # 1 hour in milliseconds
    authRenewTokenMinValidity: 70  # Renew token when 70 seconds validity remains
    authLogoutRedirectUri: "https://frontend-ichub.int.catena-x.net"
    
    # Keycloak configuration
    keycloak:
      url: "https://ichub-iam.int.catena-x.net/auth"
      realm: "ICHub"
      clientId: "industry-core-hub-frontend"
      realmImport:
        enabled: true
        method: "startup"
        availabilityCheck:
          timeout: "120s"
          delay: "5s"
    
  
  env:
    # Legacy backend URL (maintained for backward compatibility)
    backendUrl: "https://backend-ichub.int.catena-x.net/v1"
  ingress:
      enabled: true
      className: "nginx"
      ## Optional annotations when using the nginx ingress class
      annotations:
       cert-manager.io/cluster-issuer: letsencrypt-prod
       nginx.ingress.kubernetes.io/rewrite-target: "/$1"
       nginx.ingress.kubernetes.io/use-regex: "true"
       nginx.ingress.kubernetes.io/enable-cors: "true"
      #   # -- Provide CORS allowed origin.
      #   nginx.ingress.kubernetes.io/cors-allow-origin: "https://*.example.org"
      # -- Ingress TLS configuration
      tls:
       - secretName: "frontend-ichub.int.catena-x.net-tls"
         hosts:
           - "frontend-ichub.int.catena-x.net" 
        # # -- Provide tls secret.
        # - secretName: ""
        #   # -- Provide host for tls secret.
        #   hosts:
        #     - ""
      hosts:
        - host: "frontend-ichub.int.catena-x.net"
          paths:
            - path: /(.*)
              pathType: ImplementationSpecific
              backend:
                service: "frontend"
                port: 8080
backend:
  apiVersion: v1
  cors:
    enabled: true
    allow_origins:
      - "https://frontend-ichub.int.catena-x.net"
      - "https://backend-ichub.int.catena-x.net"
    allow_credentials: true
    allow_methods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
      - "OPTIONS"
      - "PATCH"
    allow_headers:
      - "*"
  # -- Persistance configuration for the backend
  persistence:
    # -- Create a PVC to persist storage (if disabled, data and logs will not be persisted)
    enabled: true
    data:
      # -- Enable data persistence
      enabled: true
      # -- Storage size for data
      size: 1Gi
      # -- Access mode for data volume
      accessMode: ReadWriteOnce
      # -- Storage class for data volume
      storageClass: "default"
    logs:
      # -- Enable logs persistence
      enabled: true
      # -- Storage size for logs
      # -- Access mode for logs volume
      accessMode: ReadWriteOnce
      # -- Storage class for logs volume
      storageClass: "default"
  configuration:
    authorization:
      enabled: true
      apiKey:
        key: "X-Api-Key"
        value: <path:industry-core-hub/data/backend#apiKey>
      keycloak:
        enabled: true
        authUrl: "https://ichub-iam.int.catena-x.net/auth/"
        realm: "ICHub"
        clientId: "industry-core-hub-api"
        clientSecret: "ichub-client-secret-2024"
        retry:
          maxRetries: 10
          retryDelay: 15
          backgroundRetryInterval: 60
    # -- Consumer configuration
    consumer:
      discovery:
        discovery_finder:
          url: "https://semantics.int.catena-x.net/discoveryfinder/api/v1.0/administration/connectors/discovery/search"
        connector_discovery:
          key: "bpn"
        oauth:
          url: "https://centralidp.int.catena-x.net/auth/"
          realm: "CX-Central"
          client_id: "<path:industry-core-hub/data/oauth#client-id>"
          client_secret: <path:industry-core-hub/data/oauth#client-secret>
        digitalTwinRegistry:
          dct_type_key: "dct:type"
          dct_type_filter:
            operandLeft: "'http://purl.org/dc/terms/type'.'@id'"
            operator: "="
            operandRight: "https://w3id.org/catenax/taxonomy#DigitalTwinRegistry"
      connector:
        dataspace:
          version: "jupiter"
        controlplane:
          hostname: "https://edc-provider-ichub-control.int.catena-x.net"
          apiKeyHeader: "X-Api-Key"
          apiKey: <path:industry-core-hub/data/edc-consumer#authKey>
          managementPath: "/management"
          protocolPath: "/api/v1/dsp"
          catalogPath: "/catalog"
    # -- Provider configuration  
    provider:
      connector: 
        dataspace:
          version: "jupiter"
        controlplane:
          hostname: "https://edc-provider-ichub-control.int.catena-x.net"
          apiKeyHeader: "X-Api-Key"
          apiKey: <path:industry-core-hub/data/edc-provider#authKey>
          managementPath: "/management"
          protocolPath: "/api/v1/dsp"
        dataplane:
          hostname: "https://edc-provider-ichub-dataplane.int.catena-x.net"
          publicPath: "/api/public"
      digitalTwinRegistry:
        hostname: "https://dtr-ichub.int.catena-x.net"
        apiPath: "/api/v3"
        uri: ""
        asset_config:
          dct_type: "https://w3id.org/catenax/taxonomy#DigitalTwinRegistry"
        lookup:
          uri: ""
    submodel_dispatcher:
      path: "/industry-core-hub/data/submodels"
      apiPath: "/submodel-dispatcher"
  ingress:
      enabled: true
      className: "nginx"
      ## Optional annotations when using the nginx ingress class
      annotations:
       cert-manager.io/cluster-issuer: letsencrypt-prod
      #   nginx.ingress.kubernetes.io/rewrite-target: "/$1"
      #   nginx.ingress.kubernetes.io/use-regex: "true"
       nginx.ingress.kubernetes.io/enable-cors: "true"
      #   # -- Provide CORS allowed origin.
       nginx.ingress.kubernetes.io/cors-allow-origin: "https://frontend-ichub.int.catena-x.net, *"
       nginx.ingress.kubernetes.io/cors-allow-credentials: "true"
      # -- Ingress TLS configuration
      tls:
       - secretName: "backend-ichub.int.catena-x.net-tls"
         hosts:
           - "backend-ichub.int.catena-x.net" 
        # # -- Provide tls secret.
        # - secretName: ""
        #   # -- Provide host for tls secret.
        #   hosts:
        #     - ""
      hosts:
      - host: "backend-ichub.int.catena-x.net"
        paths:
          - path: /
            pathType: ImplementationSpecific
            backend:
              service: "backend"
              port: 8000

keycloak:
  realm:
    users:
      - username: "ichub-admin"
        password: "changeme"
        email: "ichub-admin@example.com"
        firstName: "Industry"
        lastName: "Admin"
        emailVerified: true
        enabled: true
        attributes:
          BPN: ["BPNL000000000000"]
        realmRoles:
          - "default-roles-ichub"
          - "offline_access"
          - "uma_authorization"
    clients:
      frontend:
        redirectUris:
          - "http://localhost:3000/*"
          - "http://localhost:5173/*"
          - "https://frontend-ichub.int.catena-x.net/*"
        webOrigins:
          - "http://localhost:3000"
          - "http://localhost:5173"
          - "https://frontend-ichub.int.catena-x.net"
      backend:
        redirectUris:
          - "http://localhost:8000/*"
          - "http://localhost:9000/*"
          - "https://backend-ichub.int.catena-x.net/*"
        webOrigins:
          - "http://localhost:8000"
          - "http://localhost:9000"
          - "https://backend-ichub.int.catena-x.net"
  
  ingress:
    # -- Enable ingress record generation
    enabled: true
    # -- Provide default path for the ingress record.
    hostname: "ichub-iam.int.catena-x.net"
    # -- Enable TLS/SSL for ingress (boolean)
    tls: true
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod 